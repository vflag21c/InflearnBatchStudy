
## Job, Step, Tasklet

---
```
job 이 구동되면 Step 을 실행하고 Step 이 구동되면 Tasklet 을 실행하도록 설정
```
`job` > start(helloStep) > `Step` > tasklet() > `Tasklet`

### Job
- 일
- 일감

### Step
- 일의 항목
- 일의 단계

### Tasklet
- 작업 내용


## Job

---

### 기본개념
 - 배치 계층 구조에서 가장 상위에 있는 개념으로서 하나의 배치작업 자체를 의미함
   - ex : API 서버의 접속 로그 데이터를 통계 서버로 옮기는 배치 인 Job 자체를 의미
 - Job Configuration 을 통해 생성되는 객체 단위로서 배치작업을 어떻게 구성하고 실행할 것인지 전체적으로 설정하고 명세
 - 배치 Job을 구성하기 위한 최상위 인터페이스며 스프링 배치가 기본 구현체를 제공
 - 여러 Step을 폼하하고 있는 컨테이너로서 반드시 한개 이상의 Step으로 구성해야 함

### 기본 구현체
 - **SimpleJob**
   - 순차적으로 Step 을 실행시키는 Job
   - 모든 Job에서 유용하게 사용할 수 있는 표준 기능을 갖고 있음


 - **FlowJob**
   - `특정한 조건과 흐름`에 따라 Step 을 구성하여 실행시키는 Job
   - Flow 객체를 실행시켜 작업을 진행함
 
## JobInstance

### 기본개념
 - Job이 실행될 때 생성되는 Job의 논리적 실행 단위 객체로서 `고유하게 식별 가능한 작업` 실행
 - Job의 설정과 구성은 동일하지만 Job이 실행되는 시점에 처리하는 내용은 다르기 때문에 `Job의 실행을 구분`해야 함
   - ex : 하루에 한 번 씩 배치 Job이 실행된다면 매일 실행되는 각각의 Job 을 JobInstance로 표현
 - JobInstance 생성 및 실행
   - 처음 시작하는 Job + JobParameter 일 경우 새로운 JobInstance 생성
   - 이전과 동일한 Job + JobParameter 으로 실행 할 경우 이미 존재하는 JobInstance 리턴
     - 내부적으로 JobName + JobKey ( 해시값 ) 를 가지고 JobInstance 객체를 얻음
   - Job과는 1:M 관계

### BATCH_JOB_INSANCE 테이블과 맵핑
 - JOB_NAME(Job) 과 JOB_KEY( 파라미터 해시 값 ) 가 동일한 데이터는 중복해서 저장 할 수 없음
  > 최초 Job 호출 시, 동일한 데이터의 호출이 이뤄질 경우 수행 되지 않음
 

## JobParameter

### 기본개념
 - Job을 실행할 때 함께 포함되어 사용되는 파라미터를 가진 도메인 객체
 - 하나의 Job에 존재할 수 있는 여러개의 `JobInstance를 구분하기 위한 용도`
 - JobParameters와 JobInstance는 1:1 관계

### 생성 및 바인딩
 - 어플리케이션 실행 시 주입
   - Java -jar Batch.jar requestData = 20210101
 - 코드로 생성
   - JobParameterBuilder, DefaultJobParametersConverter
 - SpEL 이용
   - @Value("`#{JobParameter[requestDate]}`"), `@JobScope`, `@StepScope` 선언 필수

### BATCH_JOB_EXECUTION_PARAMS 테이블과 맵핑
 - JOB_EXECUTION 과 1:M의 관계

## JobExecution

### 기본개념
 - JobInstance 에 대한 한번의 시도를 의미하는 객체로서 Job 실행 중에 발생한 정보들을 저장하고 있는 객체
   - `시작시간`, `종료시간`, `상태`(시작됨, 완료, 실패), `종료상태`의 속성을 가짐


 - JobInstance 와 관계
   - JobExecution 은 `FAILED` 또는 `COMPLETED` 등의 Job 의 실행 결과 상태를 가지고 있음
   - JobExecution 의 실행 상태 결과가 `COMPLETED` 면 JobInstance 실행이 완료 된 것으로 간주해서 `재실행 불가`
   - JobExecution 의 실행 상태 결과가 `FAILED`면 JobInstance 실행이 완료되지 않은 것으로 간주해서 `재실행 가능`
     - JobParameter 가 동일한 값으로 Job을 실행할지라도 JobInstance를 계속 실행할 수 있음
   - JobExecution 의 실행 상태 결과가 `COMPLETED`될 때까지 하나의 JobInstance 내에서 여러 번의 시도가 생길 수 있음
 
### BATCH_JOB_EXECUTION
 - JobInstance 와 JobExecution 는 1:M 의 관계로서 JobInstance 에 대한 `성공`, `실패`의 **내역을 가지고 있음**
![img_1.png](img_1.png)
